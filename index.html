<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Emoji k√≥dol√≥/dek√≥dol√≥</title>
<style>
  :root{--bg:#071022;--card:#0f1724;--muted:#9ca3af;--accent:#06b6d4;--glass:rgba(255,255,255,0.02);}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:#e6eef6;background:linear-gradient(180deg,#04101a,#081226);padding:20px;}
  .container{max-width:1100px;margin:0 auto;}
  .layout{display:grid;grid-template-columns:1fr 360px;gap:14px;}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.02);}
  label.small{display:block;color:var(--muted);font-size:13px;margin-bottom:6px;}
  textarea,input[type="text"],input[type="number"]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);color:inherit;resize:vertical;}
  textarea{min-height:120px;font-family:monospace;}
  .row{display:flex;gap:10px;align-items:center;}
  button{background:var(--accent);color:#042331;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:6px 8px;}
  .emoji-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;max-height:360px;overflow:auto;padding:6px;background:rgba(255,255,255,0.01);border-radius:8px;}
  .emoji-btn{background:transparent;border:1px solid rgba(255,255,255,0.02);padding:8px;border-radius:8px;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
  .emoji-btn.selected{outline:3px solid rgba(6,182,212,0.12);box-shadow:0 8px 24px rgba(6,182,212,0.04);}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
  .output-box{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.005));padding:10px;border-radius:8px;font-family:monospace;word-break:break-all;color:#cfeff6;min-height:60px;}
  .small-muted{font-size:12px;color:var(--muted);}
  .modal{position:fixed;inset:0;background:linear-gradient(rgba(2,6,23,0.7),rgba(2,6,23,0.75));display:flex;align-items:center;justify-content:center;z-index:40;}
  .modal .card{width:840px;max-width:96%;}
  .flex{display:flex;gap:8px;align-items:center;}
</style>
</head>
<body>
<div class="container">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <h2 style="margin:0;font-size:18px;">Emoji k√≥dol√≥</h2>
    <div style="color:var(--muted);font-size:13px;"></div>
  </div>

  <div class="layout">
    <div class="card">
      <div class="row" style="margin-bottom:12px;">
        <label><input type="radio" name="mode" value="encode" checked> K√≥dol√°s</label>
        <label style="margin-left:12px;"><input type="radio" name="mode" value="decode"> Dek√≥dol√°s</label>
      </div>

      <div id="encodeArea">
        <label class="small">Sz√∂veg</label>
        <textarea id="plainText" placeholder="Sz√∂vegbevitel"></textarea>

        <div style="display:flex;gap:10px;margin-top:8px;">
          <div style="flex:1;">
            <label class="small">Szegmens (byte) Ezekkel nem kell foglalkozni, ezek fejleszt≈ëi be√°ll√≠t√°sok. Hagyd alap√©rtelmezetten.</label>
            <input id="segmentSize" type="number" min="16" max="65536" value="512" />
            <div class="small-muted">Rejtett adat m√©rete</div>
          </div>
          <div style="width:170px;">
            <label class="small">Max iter√°ci√≥</label>
            <input id="maxRounds" type="number" min="1" max="128" value="32" />
            <div class="small-muted"></div>
          </div>
        </div>

        <div style="margin-top:12px;">
          <label class="small">Kiv√°lasztott emoji-k</label>
          <div id="selectedEmojis" class="flex" style="flex-wrap:wrap;gap:8px;margin-bottom:8px;"></div>
          <button class="ghost" id="openPaletteBtn">Paletta</button>
        </div>

        <div class="controls" style="margin-top:12px;">
          <button id="doEncode">K√≥dol</button>
          <button id="clearEncode" class="ghost">T√∂r√∂l</button>
        </div>

        <div style="margin-top:12px;">
          <label class="small">Kimenet</label>
          <div class="output-box" id="encodedOutput"></div>
          <div style="margin-top:8px;"><button id="copyEncoded">M√°sol</button></div>
        </div>
      </div>

      <div id="decodeArea" style="display:none;">
        <label class="small">Titkos√≠tott sz√∂veg (k√∂t≈ëjellel elv√°lasztva)</label>
        <textarea id="encodedInput" placeholder="Pl.: üòÄ-üöÄ - ..."></textarea>

        <div style="margin-top:8px;">
          <label class="small">Dek√≥dolt</label>
          <div class="output-box" id="decodedOutput"></div>
          <div style="margin-top:8px;"><button id="copyDecoded">M√°sol</button></div>
        </div>

        <div class="controls" style="margin-top:8px;">
          <button id="doDecode">Dek√≥dol</button>
          <button id="clearDecode" class="ghost">T√∂r√∂l</button>
        </div>
      </div>
    </div>

    <aside class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div class="small-muted">Paletta</div>
        <input id="emojiSearch" type="text" placeholder="keres√©s" style="width:140px;padding:6px;border-radius:6px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);" />
      </div>
      <div id="emojiPalette" class="emoji-grid" style="margin-top:10px;"></div>
    </aside>
  </div>
</div>

<div id="modal" style="display:none;" class="modal">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3 style="margin:0;font-size:16px;">V√°lassz emojikat</h3>
      <div><button id="closeModal" class="ghost">Bez√°r</button></div>
    </div>
    <div id="modalPalette" class="emoji-grid" style="margin-top:12px;"></div>
    <div style="margin-top:12px;text-align:right;">
      <button id="modalDone">K√©sz</button>
    </div>
  </div>
</div>

<script>
/*        Ez a kulcs: vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv  A program ez alapj√°n dek√≥dol √©s k√≥dol. Ide megadhatsz b√°rmilyen, legal√°bb 40 karakter hossz√∫ kulcsot, a k√©t id√©z≈ëjel k√∂z√©. pl.: "w6#n=#VB6)Yu2%lve,_8W0n;6oKRr=p}HIbh>.nJ" √©s ha k√ºldesz valakinek ilyen emojit, akkor ≈ë csak akkor tudja dek√≥dolni ha n√°la is ugyanaz a kulcs van be√°ll√≠tva mint n√°lad. A kulcsodat cser√©ld le az alap sz√∂vegre. (Alap sz√∂veg: IDE_KELL_BE√çRNI_A_SAJ√ÅT_KULCSOT_√öGY_AHOGY_FELJEBB_LE_VAN_√çRVA ) */

const KULCS = "IDE_KELL_BE√çRNI_A_SAJ√ÅT_KULCSOT_√öGY_AHOGY_FELJEBB_LE_VAN_√çRVA";

/* bels≈ë be√°ll√≠t√°sok */
const ZER√ì = '\u200B'; // 0
const EGY = '\u200C'; // 1
const ELVALASZTO = '-';
const MAX_K√ñR = 128;

/* emoji lista (b≈ëv√≠thet≈ë) */
const EMOJIK = [
"üòÄ","üòÉ","üòÑ","üòÅ","üòÜ","üòÖ","üòÇ","ü§£","üòä","üòá","üôÇ","üôÉ","üòâ","üòå","üòç","ü•∞",
"üòò","üòó","üòô","üòö","üòã","üòõ","üòù","üòú","ü§™","ü§®","üßê","ü§ì","üòé","ü§©","ü•≥","üòè",
"üòí","üòû","üòî","üòü","üòï","üôÅ","‚òπÔ∏è","üò£","üòñ","üò´","üò©","ü•∫","üò¢","üò≠","üò§","üò†",
"üò°","ü§¨","ü§Ø","üò≥","ü•µ","ü•∂","üò±","üò®","üò∞","üò•","üòì","ü§ó","ü§î","ü§≠","ü§´","ü§•",
"ü´¢","ü´£","üò∂","üòê","üòë","üò¨","üôÑ","üòØ","üò¶","üòß","üòÆ","üò≤","ü•±","üò¥","ü§§","üò™",
"üê∂","üê±","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","üê®","üêØ","ü¶Å","üêÆ","üê∑","üêΩ","üê∏","üêµ",
"üôà","üôâ","üôä","üêí","üêî","üêß","üê¶","üê§","ü¶Ü","ü¶Ö","ü¶â","ü¶á","üê∫","ü¶Ñ","üêù","üêõ",
"ü¶ã","üêå","üêû","üêú","ü™≤","ü™≥","ü¶ü","ü¶ó","üê¢","üêç","ü¶é","ü¶Ç","üêô","ü¶ë","ü¶ê","ü¶û",
"üçè","üçé","üçê","üçä","üçã","üçå","üçâ","üçá","üçì","ü´ê","üçí","üçë","ü•≠","üçç","ü••","ü•ù",
"üçÖ","üçÜ","ü•ë","ü•¶","ü•¨","ü•ï","üåΩ","ü•î","üç†","ü•ê","üçû","ü•ñ","ü•®","üßÄ","üçó","üçñ",
"üçï","üå≠","üçî","üçü","ü•™","üåÆ","üåØ","ü•ô","üßÜ","üç£","üç±","üçõ","üçú","üç≤","üç•","ü•Æ",
"‚òï","ü´ñ","üçµ","üßã","üç∫","üçª","ü•Ç","üç∑","ü•É","üç∏","üçπ","üßâ","‚öΩ","üèÄ","üèà","‚öæ",
"üéæ","üèê","üèâ","üé±","üèì","üè∏","ü•Ö","üèí","üèë","ü•è","üéØ","üé≥","üéÆ","üé≤","üß©","ü™Ä",
"üéπ","üé∏","üéª","ü•Å","üé∑","üé∫","ü™ó","üé∂","üéµ","üé§","üéß","üì∑","üé¨","üì∫","üìª","üí°",
"üî¶","üïØÔ∏è","üóùÔ∏è","üîí","üîë","üí£","ü™ì","üîß","üî®","ü™ö","‚öôÔ∏è","‚è∞","‚è±Ô∏è","üì°","üîã","üíª",
"üñ•Ô∏è","üñ®Ô∏è","üß≠","ü™ê","üåç","üåé","üåè","‚òÄÔ∏è","üå§Ô∏è","‚õÖ","üåßÔ∏è","‚òÅÔ∏è","‚ö°","üî•","üíß","‚ùÑÔ∏è",
"üåä","üå™Ô∏è","üåà","üåµ","üå≤","üå≥","üå¥","üå±","üåø","‚òòÔ∏è","üçÄ","üå∫","üå∏","üåº","üåª","üåπ",
"üöó","üöï","üöô","üöå","üöé","üèéÔ∏è","üöì","üöë","üöí","üöê","üöö","üöõ","üöú","üõ¥","üö≤","üõµ",
"‚úàÔ∏è","üõ©Ô∏è","üõ∞Ô∏è","üöÄ","‚õµ","üö¢","üèÅ","üéØ","üèÜ","üèÖ","ü•á","ü•à","ü•â","üéóÔ∏è","üß≠","ü™Ç"
];

/* UI elemek */
const paletta = document.getElementById('emojiPalette');
const modpaletta = document.getElementById('modalPalette');
const kivEmojik = document.getElementById('selectedEmojis');
const nyitPaletta = document.getElementById('openPaletteBtn');
const ablak = document.getElementById('modal');
const ablakKesz = document.getElementById('modalDone');
const ablakZar = document.getElementById('closeModal');
const keres = document.getElementById('emojiSearch');
const modpalettaEl = document.getElementById('modalPalette');

const kodoltKi = document.getElementById('encodedOutput');
const dekodoltKi = document.getElementById('decodedOutput');

let kiv = [];
let ablakKiv = new Set();

function rajzPaletta(gy√∂k√©r, katt, sz≈±r≈ë=""){
  gy√∂k√©r.innerHTML = '';
  const f = sz≈±r≈ë.trim().toLowerCase();
  for (let e of EMOJIK){
    if (f && !e.includes(f) && !emojiSz√≥Egyezik(e, f)) continue;
    const gomb = document.createElement('button');
    gomb.className = 'emoji-btn';
    gomb.textContent = e;
    gomb.onclick = ()=>katt(e, gomb);
    gy√∂k√©r.appendChild(gomb);
  }
}
// Emoji keres≈ë sz√≥t√°r (p√°r gyakori emojihoz magyar kulcssz√≥)
function emojiSz√≥Egyezik(e, q){
  const kulcsszavak = {
    "üòÄ":"arc","üöÄ":"rak√©ta","üê±":"cica","üçï":"pizza","üé©":"kalap","üì°":"antenna","üéµ":"hangjegy",
    "üî•":"t≈±z","üåç":"F√∂ld","üòÉ":"arc2","üòÑ":"arc3","üòÇ":"nevet","üòç":"szeret","üëç":"like"
  };
  const s = (kulcsszavak[e]||"").toLowerCase();
  return s.includes(q);
}

function rajzKiv(){
  kivEmojik.innerHTML = '';
  for (let i=0;i<kiv.length;i++){
    const e = kiv[i];
    const b = document.createElement('button');
    b.className = 'emoji-btn';
    b.style.fontSize='20px';
    b.textContent = e;
    const eltav = document.createElement('button');
    eltav.textContent='‚úñ';
    eltav.style.marginLeft='6px';
    eltav.className='ghost';
    eltav.onclick = ()=>{ kiv.splice(i,1); rajzKiv(); };
    const csomag = document.createElement('div');
    csomag.style.display='flex';
    csomag.style.alignItems='center';
    csomag.appendChild(b);
    csomag.appendChild(eltav);
    kivEmojik.appendChild(csomag);
  }
}

rajzPaletta(paletta, (e,gomb)=>{
  if (!kiv.includes(e)) kiv.push(e);
  rajzKiv();
});
nyitPaletta.onclick = ()=>{ ablakKiv = new Set(kiv); rajzPaletta(modpaletta, ablakKatt); ablak.style.display='flex'; }
ablakZar.onclick = ()=>{ ablak.style.display='none'; }
ablakKesz.onclick = ()=>{
  kiv = Array.from(ablakKiv);
  rajzKiv();
  ablak.style.display='none';
};
function ablakKatt(e,gomb){
  if (ablakKiv.has(e)) ablakKiv.delete(e);
  else ablakKiv.add(e);
  rajzAblakKiv();
}
function rajzAblakKiv(){
  modpaletta.querySelectorAll('.emoji-btn').forEach(b=>{
    const ch = b.textContent;
    if (ablakKiv.has(ch)) b.classList.add('selected'); else b.classList.remove('selected');
  });
}
keres.addEventListener('input', ()=>{ rajzPaletta(paletta, (e,gomb)=>{ if (!kiv.includes(e)) kiv.push(e); rajzKiv(); }, keres.value); rajzPaletta(modpaletta, ablakKatt, keres.value); });

function sz√∂vegB√°jt(s){ return new TextEncoder().encode(s); }
function b√°jtSz√∂veg(u8){ return new TextDecoder().decode(u8); }

async function kulcsLek√©r(){
  const nyers = sz√∂vegB√°jt(KULCS);
  const hash = await crypto.subtle.digest('SHA-256', nyers);
  return await crypto.subtle.importKey('raw', hash, {name:'AES-GCM'}, false, ['encrypt','decrypt']);
}

function b√°jtZW(u8){
  let ki = '';
  for (let b of u8){
    for (let i=7;i>=0;i--){
      ki += ((b>>i)&1) ? EGY : ZER√ì;
    }
  }
  return ki;
}
function zwB√°jt(s){
  const bitek = [];
  for (let ch of s){
    if (ch === ZER√ì) bitek.push(0);
    else if (ch === EGY) bitek.push(1);
  }
  const b√°jtok = new Uint8Array(Math.floor(bitek.length/8));
  for (let i=0;i+7<bitek.length;i+=8){
    let v=0;
    for (let j=0;j<8;j++){ v = (v<<1) | bitek[i+j]; }
    b√°jtok[i/8]=v;
  }
  return b√°jtok;
}

function darabB√°jt(u8, m√©ret){
  const ki=[];
  for (let i=0;i<u8.length;i+=m√©ret) ki.push(u8.slice(i, i+m√©ret));
  return ki;
}
async function titkos√≠tB√°jt(simaB√°jt){
  const kulcs = await kulcsLek√©r();
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const ct = await crypto.subtle.encrypt({name:'AES-GCM', iv:iv}, kulcs, simaB√°jt);
  const ctU8 = new Uint8Array(ct);
  const csomag = new Uint8Array(iv.length + ctU8.length);
  csomag.set(iv,0);
  csomag.set(ctU8, iv.length);
  return csomag;
}

async function visszafejtB√°jt(csomag){
  const kulcs = await kulcsLek√©r();
  const iv = csomag.slice(0,12);
  const ct = csomag.slice(12);
  const sima = await crypto.subtle.decrypt({name:'AES-GCM', iv:iv}, kulcs, ct);
  return new Uint8Array(sima);
}

document.getElementById('doEncode').addEventListener('click', async ()=>{
  kodoltKi.textContent = '';
  let sz√∂veg = document.getElementById('plainText').value || '';
  if (!sz√∂veg){ kodoltKi.textContent = ''; return; }
  if (kiv.length===0){ kodoltKi.textContent = ''; return; }
  const szegmens = Number(document.getElementById('segmentSize').value) || 512;
  const maxKor = Math.min(MAX_K√ñR, Number(document.getElementById('maxRounds').value) || 32);
  const simaB√°jt = sz√∂vegB√°jt(sz√∂veg);
  const csomag = await titkos√≠tB√°jt(simaB√°jt);
  let darabok = darabB√°jt(csomag, szegmens);
  let kiDarabok = [];
  let hasznEmojik = [...kiv];
  let k√∂r = 0;
  while (darabok.length > hasznEmojik.length){
    if (k√∂r >= maxKor) break;
    ablakKiv = new Set(hasznEmojik);
    rajzPaletta(modpaletta, (e,gomb)=>{
      if (ablakKiv.has(e)) ablakKiv.delete(e); else ablakKiv.add(e);
      rajzAblakKiv();
    });
    ablak.style.display='flex';
    const res = await new Promise(resolve=>{
      ablakKesz.onclick = ()=>{ resolve(true); ablak.style.display='none'; };
      ablakZar.onclick = ()=>{ resolve(false); ablak.style.display='none'; };
    });
    if (!res) break;
    hasznEmojik = Array.from(ablakKiv);
    k√∂r++;
  }
  for (let i=0;i<darabok.length;i++){
    const emoji = hasznEmojik[i % hasznEmojik.length] || kiv[i % kiv.length];
    const bitek = b√°jtZW(darabok[i]);
    kiDarabok.push(emoji + bitek);
  }
  kodoltKi.textContent = kiDarabok.join(ELVALASZTO);
});

document.getElementById('doDecode').addEventListener('click', async ()=>{
  dekodoltKi.textContent = '';
  let bevitel = document.getElementById('encodedInput').value || '';
  if (!bevitel) return;
  const r√©szek = bevitel.split(ELVALASZTO).map(p=>p.trim()).filter(Boolean);
  const csomagDarabok = [];
  for (let p of r√©szek){
    let idx = -1;
    for (let i=0;i<p.length;i++){
      const cp = p[i];
      if (cp === ZER√ì || cp === EGY){ idx = i; break; }
      const k√≥d = p.codePointAt(i);
      if (k√≥d === 0x200B || k√≥d === 0x200C){ idx = i; break; }
    }
    if (idx===-1) continue;
    const zw = p.slice(idx);
    const b√°jtok = zwB√°jt(zw);
    csomagDarabok.push(b√°jtok);
  }
  if (csomagDarabok.length===0) return;
  let √∂sszHossz = csomagDarabok.reduce((s,a)=>s+a.length,0);
  const √∂ssz = new Uint8Array(√∂sszHossz);
  let eltol=0;
  for (let arr of csomagDarabok){ √∂ssz.set(arr, eltol); eltol+=arr.length; }
  try {
    const sima = await visszafejtB√°jt(√∂ssz);
    dekodoltKi.textContent = b√°jtSz√∂veg(sima);
  } catch(e){
    dekodoltKi.textContent = 'Hiba: nem siker√ºlt dek√≥dolni.';
  }
});

document.getElementById('copyEncoded').addEventListener('click', async ()=>{
  const t = kodoltKi.textContent || '';
  if (!t) return;
  await navigator.clipboard.writeText(t);
});
document.getElementById('copyDecoded').addEventListener('click', async ()=>{
  const t = dekodoltKi.textContent || '';
  if (!t) return;
  await navigator.clipboard.writeText(t);
});

document.getElementById('clearEncode').addEventListener('click', ()=>{ document.getElementById('plainText').value=''; kodoltKi.textContent=''; });
document.getElementById('clearDecode').addEventListener('click', ()=>{ document.getElementById('encodedInput').value=''; dekodoltKi.textContent=''; });

document.querySelectorAll('input[name="mode"]').forEach(r=>{
  r.addEventListener('change',(ev)=>{
    const v = ev.target.value;
    document.getElementById('encodeArea').style.display = v==='encode' ? 'block' : 'none';
    document.getElementById('decodeArea').style.display = v==='decode' ? 'block' : 'none';
  });
});

rajzPaletta(paletta, (e,gomb)=>{
  if (!kiv.includes(e)) kiv.push(e);
  rajzKiv();
});
rajzPaletta(modpaletta, (e,gomb)=>{  });
</script>
</body>
</html>