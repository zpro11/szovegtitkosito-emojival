<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Emoji kódoló/dekódoló</title>
<style>
  :root{--bg:#071022;--card:#0f1724;--muted:#9ca3af;--accent:#06b6d4;--glass:rgba(255,255,255,0.02);}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:#e6eef6;background:linear-gradient(180deg,#04101a,#081226);padding:20px;}
  .container{max-width:1100px;margin:0 auto;}
  .layout{display:grid;grid-template-columns:1fr 360px;gap:14px;}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.02);}
  label.small{display:block;color:var(--muted);font-size:13px;margin-bottom:6px;}
  textarea,input[type="text"],input[type="number"]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);color:inherit;resize:vertical;}
  textarea{min-height:120px;font-family:monospace;}
  .row{display:flex;gap:10px;align-items:center;}
  button{background:var(--accent);color:#042331;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);padding:6px 8px;}
  .emoji-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;max-height:360px;overflow:auto;padding:6px;background:rgba(255,255,255,0.01);border-radius:8px;}
  .emoji-btn{background:transparent;border:1px solid rgba(255,255,255,0.02);padding:8px;border-radius:8px;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
  .emoji-btn.selected{outline:3px solid rgba(6,182,212,0.12);box-shadow:0 8px 24px rgba(6,182,212,0.04);}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
  .output-box{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.005));padding:10px;border-radius:8px;font-family:monospace;word-break:break-all;color:#cfeff6;min-height:60px;}
  .small-muted{font-size:12px;color:var(--muted);}
  .modal{position:fixed;inset:0;background:linear-gradient(rgba(2,6,23,0.7),rgba(2,6,23,0.75));display:flex;align-items:center;justify-content:center;z-index:40;}
  .modal .card{width:840px;max-width:96%;}
  .flex{display:flex;gap:8px;align-items:center;}
</style>
</head>
<body>
<div class="container">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
    <h2 style="margin:0;font-size:18px;">Emoji kódoló</h2>
    <div style="color:var(--muted);font-size:13px;"></div>
  </div>

  <div class="layout">
    <div class="card">
      <div class="row" style="margin-bottom:12px;">
        <label><input type="radio" name="mode" value="encode" checked> Kódolás</label>
        <label style="margin-left:12px;"><input type="radio" name="mode" value="decode"> Dekódolás</label>
      </div>

      <div id="encodeArea">
        <label class="small">Szöveg</label>
        <textarea id="plainText" placeholder="Szövegbevitel"></textarea>

        <div style="display:flex;gap:10px;margin-top:8px;">
          <div style="flex:1;">
            <label class="small">Szegmens (byte) Ezekkel nem kell foglalkozni, ezek fejlesztői beállítások. Hagyd alapértelmezetten.</label>
            <input id="segmentSize" type="number" min="16" max="65536" value="512" />
            <div class="small-muted">Rejtett adat mérete</div>
          </div>
          <div style="width:170px;">
            <label class="small">Max iteráció</label>
            <input id="maxRounds" type="number" min="1" max="128" value="32" />
            <div class="small-muted"></div>
          </div>
        </div>

        <div style="margin-top:12px;">
          <label class="small">Kiválasztott emoji-k</label>
          <div id="selectedEmojis" class="flex" style="flex-wrap:wrap;gap:8px;margin-bottom:8px;"></div>
          <button class="ghost" id="openPaletteBtn">Paletta</button>
        </div>

        <div class="controls" style="margin-top:12px;">
          <button id="doEncode">Kódol</button>
          <button id="clearEncode" class="ghost">Töröl</button>
        </div>

        <div style="margin-top:12px;">
          <label class="small">Kimenet</label>
          <div class="output-box" id="encodedOutput"></div>
          <div style="margin-top:8px;"><button id="copyEncoded">Másol</button></div>
        </div>
      </div>

      <div id="decodeArea" style="display:none;">
        <label class="small">Titkosított szöveg (kötőjellel elválasztva)</label>
        <textarea id="encodedInput" placeholder="Pl.: 😀-🚀 - ..."></textarea>

        <div style="margin-top:8px;">
          <label class="small">Dekódolt</label>
          <div class="output-box" id="decodedOutput"></div>
          <div style="margin-top:8px;"><button id="copyDecoded">Másol</button></div>
        </div>

        <div class="controls" style="margin-top:8px;">
          <button id="doDecode">Dekódol</button>
          <button id="clearDecode" class="ghost">Töröl</button>
        </div>
      </div>
    </div>

    <aside class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div class="small-muted">Paletta</div>
        <input id="emojiSearch" type="text" placeholder="keresés" style="width:140px;padding:6px;border-radius:6px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);" />
      </div>
      <div id="emojiPalette" class="emoji-grid" style="margin-top:10px;"></div>
    </aside>
  </div>
</div>

<div id="modal" style="display:none;" class="modal">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3 style="margin:0;font-size:16px;">Válassz emojikat</h3>
      <div><button id="closeModal" class="ghost">Bezár</button></div>
    </div>
    <div id="modalPalette" class="emoji-grid" style="margin-top:12px;"></div>
    <div style="margin-top:12px;text-align:right;">
      <button id="modalDone">Kész</button>
    </div>
  </div>
</div>

<script>
/*        Ez a kulcs: vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv  A program ez alapján dekódol és kódol. Ide megadhatsz bármilyen, legalább 40 karakter hosszú kulcsot, a két idézőjel közé. pl.: "w6#n=#VB6)Yu2%lve,_8W0n;6oKRr=p}HIbh>.nJ" és ha küldesz valakinek ilyen emojit, akkor ő csak akkor tudja dekódolni ha nála is ugyanaz a kulcs van beállítva mint nálad. A kulcsodat cseréld le az alap szövegre. (Alap szöveg: IDE_KELL_BEÍRNI_A_SAJÁT_KULCSOT_ÚGY_AHOGY_FELJEBB_LE_VAN_ÍRVA ) */

const KULCS = "IDE_KELL_BEÍRNI_A_SAJÁT_KULCSOT_ÚGY_AHOGY_FELJEBB_LE_VAN_ÍRVA";

/* belső beállítások */
const ZERÓ = '\u200B'; // 0
const EGY = '\u200C'; // 1
const ELVALASZTO = '-';
const MAX_KÖR = 128;

/* emoji lista (bővíthető) */
const EMOJIK = [
"😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","🥰",
"😘","😗","😙","😚","😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","🤩","🥳","😏",
"😒","😞","😔","😟","😕","🙁","☹️","😣","😖","😫","😩","🥺","😢","😭","😤","😠",
"😡","🤬","🤯","😳","🥵","🥶","😱","😨","😰","😥","😓","🤗","🤔","🤭","🤫","🤥",
"🫢","🫣","😶","😐","😑","😬","🙄","😯","😦","😧","😮","😲","🥱","😴","🤤","😪",
"🐶","🐱","🐭","🐹","🐰","🦊","🐻","🐼","🐨","🐯","🦁","🐮","🐷","🐽","🐸","🐵",
"🙈","🙉","🙊","🐒","🐔","🐧","🐦","🐤","🦆","🦅","🦉","🦇","🐺","🦄","🐝","🐛",
"🦋","🐌","🐞","🐜","🪲","🪳","🦟","🦗","🐢","🐍","🦎","🦂","🐙","🦑","🦐","🦞",
"🍏","🍎","🍐","🍊","🍋","🍌","🍉","🍇","🍓","🫐","🍒","🍑","🥭","🍍","🥥","🥝",
"🍅","🍆","🥑","🥦","🥬","🥕","🌽","🥔","🍠","🥐","🍞","🥖","🥨","🧀","🍗","🍖",
"🍕","🌭","🍔","🍟","🥪","🌮","🌯","🥙","🧆","🍣","🍱","🍛","🍜","🍲","🍥","🥮",
"☕","🫖","🍵","🧋","🍺","🍻","🥂","🍷","🥃","🍸","🍹","🧉","⚽","🏀","🏈","⚾",
"🎾","🏐","🏉","🎱","🏓","🏸","🥅","🏒","🏑","🥏","🎯","🎳","🎮","🎲","🧩","🪀",
"🎹","🎸","🎻","🥁","🎷","🎺","🪗","🎶","🎵","🎤","🎧","📷","🎬","📺","📻","💡",
"🔦","🕯️","🗝️","🔒","🔑","💣","🪓","🔧","🔨","🪚","⚙️","⏰","⏱️","📡","🔋","💻",
"🖥️","🖨️","🧭","🪐","🌍","🌎","🌏","☀️","🌤️","⛅","🌧️","☁️","⚡","🔥","💧","❄️",
"🌊","🌪️","🌈","🌵","🌲","🌳","🌴","🌱","🌿","☘️","🍀","🌺","🌸","🌼","🌻","🌹",
"🚗","🚕","🚙","🚌","🚎","🏎️","🚓","🚑","🚒","🚐","🚚","🚛","🚜","🛴","🚲","🛵",
"✈️","🛩️","🛰️","🚀","⛵","🚢","🏁","🎯","🏆","🏅","🥇","🥈","🥉","🎗️","🧭","🪂"
];

/* UI elemek */
const paletta = document.getElementById('emojiPalette');
const modpaletta = document.getElementById('modalPalette');
const kivEmojik = document.getElementById('selectedEmojis');
const nyitPaletta = document.getElementById('openPaletteBtn');
const ablak = document.getElementById('modal');
const ablakKesz = document.getElementById('modalDone');
const ablakZar = document.getElementById('closeModal');
const keres = document.getElementById('emojiSearch');
const modpalettaEl = document.getElementById('modalPalette');

const kodoltKi = document.getElementById('encodedOutput');
const dekodoltKi = document.getElementById('decodedOutput');

let kiv = [];
let ablakKiv = new Set();

function rajzPaletta(gyökér, katt, szűrő=""){
  gyökér.innerHTML = '';
  const f = szűrő.trim().toLowerCase();
  for (let e of EMOJIK){
    if (f && !e.includes(f) && !emojiSzóEgyezik(e, f)) continue;
    const gomb = document.createElement('button');
    gomb.className = 'emoji-btn';
    gomb.textContent = e;
    gomb.onclick = ()=>katt(e, gomb);
    gyökér.appendChild(gomb);
  }
}
// Emoji kereső szótár (pár gyakori emojihoz magyar kulcsszó)
function emojiSzóEgyezik(e, q){
  const kulcsszavak = {
    "😀":"arc","🚀":"rakéta","🐱":"cica","🍕":"pizza","🎩":"kalap","📡":"antenna","🎵":"hangjegy",
    "🔥":"tűz","🌍":"Föld","😃":"arc2","😄":"arc3","😂":"nevet","😍":"szeret","👍":"like"
  };
  const s = (kulcsszavak[e]||"").toLowerCase();
  return s.includes(q);
}

function rajzKiv(){
  kivEmojik.innerHTML = '';
  for (let i=0;i<kiv.length;i++){
    const e = kiv[i];
    const b = document.createElement('button');
    b.className = 'emoji-btn';
    b.style.fontSize='20px';
    b.textContent = e;
    const eltav = document.createElement('button');
    eltav.textContent='✖';
    eltav.style.marginLeft='6px';
    eltav.className='ghost';
    eltav.onclick = ()=>{ kiv.splice(i,1); rajzKiv(); };
    const csomag = document.createElement('div');
    csomag.style.display='flex';
    csomag.style.alignItems='center';
    csomag.appendChild(b);
    csomag.appendChild(eltav);
    kivEmojik.appendChild(csomag);
  }
}

rajzPaletta(paletta, (e,gomb)=>{
  if (!kiv.includes(e)) kiv.push(e);
  rajzKiv();
});
nyitPaletta.onclick = ()=>{ ablakKiv = new Set(kiv); rajzPaletta(modpaletta, ablakKatt); ablak.style.display='flex'; }
ablakZar.onclick = ()=>{ ablak.style.display='none'; }
ablakKesz.onclick = ()=>{
  kiv = Array.from(ablakKiv);
  rajzKiv();
  ablak.style.display='none';
};
function ablakKatt(e,gomb){
  if (ablakKiv.has(e)) ablakKiv.delete(e);
  else ablakKiv.add(e);
  rajzAblakKiv();
}
function rajzAblakKiv(){
  modpaletta.querySelectorAll('.emoji-btn').forEach(b=>{
    const ch = b.textContent;
    if (ablakKiv.has(ch)) b.classList.add('selected'); else b.classList.remove('selected');
  });
}
keres.addEventListener('input', ()=>{ rajzPaletta(paletta, (e,gomb)=>{ if (!kiv.includes(e)) kiv.push(e); rajzKiv(); }, keres.value); rajzPaletta(modpaletta, ablakKatt, keres.value); });

function szövegBájt(s){ return new TextEncoder().encode(s); }
function bájtSzöveg(u8){ return new TextDecoder().decode(u8); }

async function kulcsLekér(){
  const nyers = szövegBájt(KULCS);
  const hash = await crypto.subtle.digest('SHA-256', nyers);
  return await crypto.subtle.importKey('raw', hash, {name:'AES-GCM'}, false, ['encrypt','decrypt']);
}

function bájtZW(u8){
  let ki = '';
  for (let b of u8){
    for (let i=7;i>=0;i--){
      ki += ((b>>i)&1) ? EGY : ZERÓ;
    }
  }
  return ki;
}
function zwBájt(s){
  const bitek = [];
  for (let ch of s){
    if (ch === ZERÓ) bitek.push(0);
    else if (ch === EGY) bitek.push(1);
  }
  const bájtok = new Uint8Array(Math.floor(bitek.length/8));
  for (let i=0;i+7<bitek.length;i+=8){
    let v=0;
    for (let j=0;j<8;j++){ v = (v<<1) | bitek[i+j]; }
    bájtok[i/8]=v;
  }
  return bájtok;
}

function darabBájt(u8, méret){
  const ki=[];
  for (let i=0;i<u8.length;i+=méret) ki.push(u8.slice(i, i+méret));
  return ki;
}
async function titkosítBájt(simaBájt){
  const kulcs = await kulcsLekér();
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const ct = await crypto.subtle.encrypt({name:'AES-GCM', iv:iv}, kulcs, simaBájt);
  const ctU8 = new Uint8Array(ct);
  const csomag = new Uint8Array(iv.length + ctU8.length);
  csomag.set(iv,0);
  csomag.set(ctU8, iv.length);
  return csomag;
}

async function visszafejtBájt(csomag){
  const kulcs = await kulcsLekér();
  const iv = csomag.slice(0,12);
  const ct = csomag.slice(12);
  const sima = await crypto.subtle.decrypt({name:'AES-GCM', iv:iv}, kulcs, ct);
  return new Uint8Array(sima);
}

document.getElementById('doEncode').addEventListener('click', async ()=>{
  kodoltKi.textContent = '';
  let szöveg = document.getElementById('plainText').value || '';
  if (!szöveg){ kodoltKi.textContent = ''; return; }
  if (kiv.length===0){ kodoltKi.textContent = ''; return; }
  const szegmens = Number(document.getElementById('segmentSize').value) || 512;
  const maxKor = Math.min(MAX_KÖR, Number(document.getElementById('maxRounds').value) || 32);
  const simaBájt = szövegBájt(szöveg);
  const csomag = await titkosítBájt(simaBájt);
  let darabok = darabBájt(csomag, szegmens);
  let kiDarabok = [];
  let hasznEmojik = [...kiv];
  let kör = 0;
  while (darabok.length > hasznEmojik.length){
    if (kör >= maxKor) break;
    ablakKiv = new Set(hasznEmojik);
    rajzPaletta(modpaletta, (e,gomb)=>{
      if (ablakKiv.has(e)) ablakKiv.delete(e); else ablakKiv.add(e);
      rajzAblakKiv();
    });
    ablak.style.display='flex';
    const res = await new Promise(resolve=>{
      ablakKesz.onclick = ()=>{ resolve(true); ablak.style.display='none'; };
      ablakZar.onclick = ()=>{ resolve(false); ablak.style.display='none'; };
    });
    if (!res) break;
    hasznEmojik = Array.from(ablakKiv);
    kör++;
  }
  for (let i=0;i<darabok.length;i++){
    const emoji = hasznEmojik[i % hasznEmojik.length] || kiv[i % kiv.length];
    const bitek = bájtZW(darabok[i]);
    kiDarabok.push(emoji + bitek);
  }
  kodoltKi.textContent = kiDarabok.join(ELVALASZTO);
});

document.getElementById('doDecode').addEventListener('click', async ()=>{
  dekodoltKi.textContent = '';
  let bevitel = document.getElementById('encodedInput').value || '';
  if (!bevitel) return;
  const részek = bevitel.split(ELVALASZTO).map(p=>p.trim()).filter(Boolean);
  const csomagDarabok = [];
  for (let p of részek){
    let idx = -1;
    for (let i=0;i<p.length;i++){
      const cp = p[i];
      if (cp === ZERÓ || cp === EGY){ idx = i; break; }
      const kód = p.codePointAt(i);
      if (kód === 0x200B || kód === 0x200C){ idx = i; break; }
    }
    if (idx===-1) continue;
    const zw = p.slice(idx);
    const bájtok = zwBájt(zw);
    csomagDarabok.push(bájtok);
  }
  if (csomagDarabok.length===0) return;
  let összHossz = csomagDarabok.reduce((s,a)=>s+a.length,0);
  const össz = new Uint8Array(összHossz);
  let eltol=0;
  for (let arr of csomagDarabok){ össz.set(arr, eltol); eltol+=arr.length; }
  try {
    const sima = await visszafejtBájt(össz);
    dekodoltKi.textContent = bájtSzöveg(sima);
  } catch(e){
    dekodoltKi.textContent = 'Hiba: nem sikerült dekódolni.';
  }
});

document.getElementById('copyEncoded').addEventListener('click', async ()=>{
  const t = kodoltKi.textContent || '';
  if (!t) return;
  await navigator.clipboard.writeText(t);
});
document.getElementById('copyDecoded').addEventListener('click', async ()=>{
  const t = dekodoltKi.textContent || '';
  if (!t) return;
  await navigator.clipboard.writeText(t);
});

document.getElementById('clearEncode').addEventListener('click', ()=>{ document.getElementById('plainText').value=''; kodoltKi.textContent=''; });
document.getElementById('clearDecode').addEventListener('click', ()=>{ document.getElementById('encodedInput').value=''; dekodoltKi.textContent=''; });

document.querySelectorAll('input[name="mode"]').forEach(r=>{
  r.addEventListener('change',(ev)=>{
    const v = ev.target.value;
    document.getElementById('encodeArea').style.display = v==='encode' ? 'block' : 'none';
    document.getElementById('decodeArea').style.display = v==='decode' ? 'block' : 'none';
  });
});

rajzPaletta(paletta, (e,gomb)=>{
  if (!kiv.includes(e)) kiv.push(e);
  rajzKiv();
});
rajzPaletta(modpaletta, (e,gomb)=>{  });
</script>
</body>
</html>